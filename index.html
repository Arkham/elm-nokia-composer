<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=VT323&display=swap" rel="stylesheet">
  <script src="app.js"></script>
  <link href="style.css" rel="stylesheet">
</head>
<body>
  <main></main>
  <script>
    var app = Elm.Main.init({ node: document.querySelector('main') })

    app.ports.sendRingtone.subscribe(function(data) {
      console.log(data);
      var context = new AudioContext();

      var real = new Float32Array(64);
      var imag = new Float32Array(64);
      var ac = new AudioContext();
      var osc = ac.createOscillator();

      real = [0.26, 0.36, 0.57, 0.84, 1, 0.79, 0.72, 0.76, 0.82, 0.84, 0.64, 0.35, 0.12, 0.19, 0.23, 0.21, 0.08, 0.10, 0.17, 0.27, 0.22, 0.20, 0.22, 0.15, 0.13, 0.12, 0.11, 0.11, 0.10, 0.09, 0.09, 0.08, 0.08, 0.07, 0.08, 0.06, 0.04, 0.03, 0.02, 0.02, 0.02, 0.02, 0.02, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0, 0];
      imag.fill(0);

      var wave = ac.createPeriodicWave(real, imag);

      data.reduce(function(now, elem) {
        oscillator = context.createOscillator();
        oscillator.connect(context.destination);
        oscillator.setPeriodicWave(wave);
        oscillator.frequency.value = elem.frequency;
        console.log(now, elem.duration);
        oscillator.start(context.currentTime + now);
        oscillator.stop(context.currentTime + now + elem.duration - 0.002);
        return(now + elem.duration);
      }, 0);
    });
  </script>
</body>
</html>
